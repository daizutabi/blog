新たな試みとして，Go言語を学んでいきます．

本シリーズでは，Go言語で実装されたマイクロマグネティックシミュレータ[mumax3](http://mumax.github.io/)を使って，実践的に学んでいきます．（mumax3はCUDAでシミュレーションを行うので，対応したGPUが必要です．）

<!-- PELICAN_END_SUMMARY -->

まずは，すでにコンパイルされた実行ファイルを使って動作を確認してみます．

[Issue 175](https://github.com/mumax/3/issues/175)には，バージョン33.10βのWindowsバイナリがアップされています，まずはこれを使ってみます．

[CUDA Toolkit v9.1](https://developer.nvidia.com/cuda-91-download-archive)をインストールします． (注) 18/8/5時点ではv9.2でうまくいかない．

インストールオプションでは，カスタムを選び，CUDAのDevelopmentとRuntimeのみを選びます．インストール先には，正確に`C:\cuda\v9.1`とします．

ダウンロードした`mumax3.10beta.cuda91.win64.zip`を展開し，`mumax3.exe`をダブルクリックします．ウェブブラウザが開き，mumax3が立ち上がります．

実際にコンパイルしていきます．

Go言語は[公式サイト](https://golang.org/)より最新版をダウンロードしてインストールします．特につまづくこともないので，詳細は略します．2018/9/4時点で，バージョン1.11がインストールされました．インストール先は， `C:\Local\Go\`にしました．

コントロールパネルから環境変数を確認すると，`GOPATH`が作られています．`%USERPROFILE%\go`です．

GCCツールチェインは，最新板のMinGW-W64 GCC-8.1.0を使います．[MinGW-w64 - for 32 and 64 bit Windows]( https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/)

7zファイルを解凍するソフトがない場合には，[7-Zip](https://sevenzip.osdn.jp/)などをインストールします．) 解凍したら，`mingw64`以下をそのまま，`C:\Users\daizu\AppData\Local`に移動し，その下の`bin`フォルダにパスを通します．

mumaxをインストールします．

```bash
go get -v github.com/mumax/3/cmd/mumax3
```

ヘッダファイルが見つからないというエラーが出ます．

mumax/3/cuda/cu/cgoflags.go
mumax/3/cuda/cufft/cgoflags.go
mumax/3/cuda/curand/cgoflags.go

のなかのWindowsのパスを正しく設定します．

////WINDOWS:
//#cgo windows LDFLAGS:-LC:/cuda/v9.1/lib/x64
//#cgo windows CFLAGS: -IC:/cuda/v9.1/include

再度インストールをします．

```bash
go install -v github.com/mumax/3/cmd/mumax3
```

`%GOPATH%\bin`したに実行ファイルが作成されます．(19,709KB)

CUDAを初期化するCのソースコードは，

```c
#include <stdio.h>
#include <cuda.h>

int main()
{
  printf("cuInit: %d", cuInit(0));
}
```

以下のようにコンパイルします．

```bash
$ gcc init.c -IC:/cuda/v9.1/include -LC:/cuda/v9.1/lib/x64 -lcuda
```

同様のGoソースは，

```go
package main

//#cgo windows LDFLAGS:-LC:/cuda/v9.1/lib/x64 -lcuda
//#cgo windows CFLAGS: -IC:/cuda/v9.1/include
//#include <stdio.h>
//#include <cuda.h>
import "C"
import "fmt"

func main() {
    fmt.Println("cuInit: ", C.cuInit(C.uint(0)))
}
```
